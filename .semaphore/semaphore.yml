version: v1.0
name: Typha
execution_time_limit:
  hours: 2
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
- name: Build
  dependencies: []
  task:
    jobs:
      - name: Build
        commands:
          - checkout
          - cache restore go-pkg-cache
          - cache restore go-mod-cache
          - 'cache store bin-${SEMAPHORE_GIT_SHA} bin'
          - cache store go-pkg-cache .go-pkg-cache
          - 'cache store go-mod-cache ${HOME}/go/pkg/mod/cache'
          - make build

- name: Test
  dependencies: ["Build"]
  task:
    prologue:
      commands:
        - checkout
        - cache restore go-pkg-cache
        - cache restore go-mod-cache
    jobs:
      - name: Tests
        commands:
          - make ci


